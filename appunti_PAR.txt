Protocolli e Architetture di Rete   
USERNAME: PAR2425
PASSWORD: dieMiephie3b

23/09/24

Rete: può essere definita ricorsivamente --> condivisa
- Due o più nodi connessi tramite collegamenti
- Due o più reti connesse tramite nodi

Componenti fondamentali di una Rete
- NODI
    - Host
        nodo terminale connesso a uno dei capi della comunicazione (mittente, destinatario) --> eterogenei
    - Switch, Bridge, Router...
        nodi intermedi che abilitano la comunicazione tra host
COLLEGAMENTO (LINK)
    - Cablato (Wired): cavi fibra ottica, coassiali, ...
    - Non cablato (Wireless): Wi-fi, Bluetooth, ...

Esempi di rete:
LAN (Local Area Netowrk): Rete locale
WAN (Wide Area Netowrk): Rete geografica

Obiettivo: trasferire un messaggio (insieme di bit) da un host all'altro

PROTOCOLLO
Tutte le comunicazioni sono regolate mediante protocolli
Protocollo: insieme di regole e convenzioni seguite da entità, dislocate su nodi distinti, che intendono comunicare per svolgere un compito comune
Tali regole hanno l’obiettivo di assicurare una cooperazione efficiente ed affidabile per la comunicazione tra nodi tenendo conto
delle caratteristiche tipiche di un sistema distribuito (banda di trasmissione limitata, ritardi variabili, errori nella comunicazione, ...)

- Sintassi: insieme e struttura dei comandi e delle risposte (formato dei messaggi)
- Semantica: significato dei comandi da effettuare al momento della trasmissione e ricezione dei messaggi (contesto corretto)
- Temporizzazione: specifica delle possibili sequenze temporali di emissione dei comandi e messaggi (sequenza temporale ammissibile)

Obiettivi della comunicazione
Trasferimento di un messaggio (insieme di bit) da un host all'altro, garantendo: 
- PRESTAZIONI: massima velocità possibile
- AFFIDABILITA': che si possano superare guasti o malfunzionamenti
- SICUREZZA: la trasmissione deve essere sicura

Stack (o suite) di protocolli: insieme di livelli in cui ogni livello cerca di risolvere in modo indipendente un sottoproblema
Nelle architetture di rete ci sono diversi tipi di funzionalità associate a ruoli diversi

Logica applicativa: implementazione di logiche applicative specializzate (Web, ...)
Comunicazione fra applicazioni: processi in esecuzione sugli host --> Affidabili (ma più lente) - Non affidabili (ma veloci)
Comunicazione fra reti: nodi che risiedono in reti differenti
Comunicazione fra nodi: nodi che risiedono nella medesima rete  

Ciascun protocollo, ad un certo livello, ha due interfacce "interne" (verso il livello superiore ed inferiore) ed una
interfaccia "esterna" verso il livello equivalente di un altro nodo
Le interfacce "interne" si occupano di trasferire i dati da un livello all'altro
L'interfaccia "esterna" rappresenta la richiesta/chiusura della connessione (astratta)

                            Protocollo livello N+1
    Interfaccia "interna"
                            Protocollo livello N    -->    Interfaccia "esterna"
    Interfaccia "interna"
                            Protocollo livello N-1

                            Mezzo fisico (hardware)

La comunicazione avviene logicamente tra protocolli che si trovano allo stesso livello

Slide 40

Communication Unit in Packet Switching: PDU
Ogni pacchetto è costituito da:
    - Protocol Control Information (PCI) --> header
        insieme di metadati necessari al corretto funzionamento del protocollo stesso
    - Service Data Unit (SDU) --> payload
        il vero contenuto informativo scambiato
PCI + SDU = PDU (Protocol Data Unit)
Messaggio: SDU (payload) + PCI (header)

Payload = (payload + header) del livello precedente --> meccanismo di incapsulamento

25/09/24

Nelle comunicazioni informatiche si inviano pacchetti

Standard de iure: creazione di uno standard per legge
Standard de facto: uso comune di un determinato standard non ancora soggetto a norma tecnica

ISO/OSI (de iure): un consorzio ha definito questo standard su carta (International Standard Organization)
TCP/IP (da facto): nato in contesti universitari 

I 7 liveli dello stack ISO/OSI
Application: protocollo applicativo che si vuole utilizzare
Presentation: si occupano di manipolare la rappresentazione delle informazioni in modo da presentarle nel miglior modo possibile (es. responsive)
Session: protocollo che crea uno stato (sessione) tra le applicazioni che eseguono tale protocollo
Transport: protocollo che gestisce la comunicazione tra applicazioni (TCP/UDP)
Network: si occupa di mettere in comunicazione tante reti (IP Address)
Data link: si occupa delle comunicazioni a livello logico locali --> indirizzamento (MAC Address)
Physical: livello che gestisce la trasmissione dell'informazione attraverso un mezzo fisico (cavo, aria, ...)

I 4 livelli dello stack TCP/IP --> stack affermatosi e che studieremo (per il numero del livello si fa riferimento allo stack ISO/OSI)
Application: accorpamento del livello di sessione, presentazione e applicazione (gestiti complessivamente dall'applicazione)
Transport: supporta i trasferimenti da host a host: TCP, UDP
Internet: ipv4-ipv6
Host-to-network: accorpamento del livello fisico e data link --> definisco sia come trasmettere l'informazione a livello fisico che come struttare le informazioni a livello logico (Bluetooth, Wi-Fi)

ISO/OSI
    - cattiva tempistica
    - cattiva tecnologia

FTP  HTTP           IRC  RTP    (Livello 5-6-7)
    |                   |
   TCP                 UDP  (Livello 4)
        |           |
             IP (Livello 3)
        |     |     |
       H2N   H2N   H2N (Livello 1-2)

RTP (Real Time Protocol)
IRC: vecchio protocollo di messaggistica

Switch e bridge sono nodi intermedi di livello 2 - H2N
Router: identifica un nodo intermedio di livello 3 (legge fino all'header IP) 
Switch lv3: switch di livello 2 con eccezioni aggiuntive da leggere un indirizzo ip
Router con funzionalità di natting: router di livello 3 ma con eccezioni aggiuntive per interpretare informazioni di livello 4

Indirizzo ip: sistema di identificazione degli host a livello 3

Multiplexing (condivisione): quando tante entità vogliono comunicare con lo stesso canale condiviso (o astratto) utilizzano un meccanismo di multiplexing affinchè le informazioni vengano mixate e inviate sullo stesso mezzo
Demultiplexing: processo che permette di ridividere le informazioni precedentemente mixate

Metodi basati sulla frequenza (FDM)
Metodi basati sul tempo (TDM)
FDM (Frequency Division Multiplexing): apertura parallela di diversi canali dividendo la banda disponibile
TDM (Time Division Multiplexing): uso alternato di tutta la banda in modo stabilito a priori

Modalità per trasferire i dati
- Circuit Switching (Commutazione a circuito)
    Circuito statico (non cambia durante la trasmissione dei dati) virtuale dedicato per ogni comunicazione
- Packet Switching (Commutazione a pacchetto)
    I dati sono suddivisi in "parti" ed inviati attraverso la rete (orientati al pacchetto)
    Ammette collisioni (interferenze) dovute a condivisione di risorse --> quando due host trasmettono contemporaneamente sullo stesso canale 
        - (Locali) Collisioni nelle reti locali con mezzi fisici condivisi
        - (Reti) Congestione nei buffer di memoria (memorizzano le code dei pacchetti) dei router --> errori o perdite di pacchetti

Metrica di prestazione
Bandwidth (banda di trasmissione): quantità di dati trasmessi per unità di tempo
- Unità di tempo: secondo
- Quantità di dati trasmessi: multipli di bit
    Kbps o Kbit/s --> Kilo-bit per secondo
    Mbps o Mbit/s --> Mega-bit per secondo
    Gbps o Gbit/s  --> Giga-bit per secondo

Livello H2N
- interconnessione tra due o più host
- trasmissione dati tra host direttamente connessi

Esempi:
LAN Wired
- Ethernet (standard de facto)
- Token-ring
- FDDI
- Frame relay

LAN Wireless
- 820.11x

PAN (Personal Area Network)
- Bluetooth
- ZigBee

WAN wireless(Wide Area Network)
- GSM
- UMTS
- LTE
- 4G
- 5G

PREMESSA PER I PROTOCOLLI H2N
Se ho dei collegamenti fisici con una probabilità alta di corruzione (perdita di pacchetto) allora è meglio implementare un protocollo host to network che garantisca l'affidabilità già a livello H2N (ritrasmissione) senza dire che poi se ne occuperà il livello 4 (TCP)

30/09/24

Modalità di trasmissione: chi sono i mittenti e i destinatari che vogliono comunicare
    - Unicast: comunicazione fra un singolo mittente e un singolo ricevente --> uno ad uno
    - Multicast: comunicazione fra un singolo mittente e un gruppo di riceventi --> uno a tanti (tutti quanti)
    - Anycast: comunicazione fra un singolo mittente ed almeno un ricevente in un gruppo --> uno a tanti (uno qualsiasi)
    - Broadcast: comunicazione fra un singolo mittente e tutti gli altri nodi --> uno a tutti

Tipi di collegamento (a livello fisico)
Collegamento broadcast / condiviso --> canale fisico broadcast
    - Molti host connessi a uno stesso canale di comunicazione
    - E' necessario un protocollo di accesso al mezzo per coordinare le trasmissioni e per evitare le collisioni (chi può trasmettere?),
      ovvero per risolvere le eventuali collisioni
    - Sono comuni nelle LAN, WirelessLAN, reti satellitari
Collegamento punto-punto
    - Costituito da un unico trasmittente a un'estremità del collegamento e da un unico ricevente all'altra estremità
    - E' il tipico collegamento fra due router o fra un modem di un accesso residenziale e il router dell'Internet Service Provider (ISP o Provider)

Si possono verificare combinazione di collegamenti --> canale fisico broadcast e collegamento logico unicast
Ethernet è un protocollo pensato per canali fisici di tipo broadcast ma per creare comunicazioni anche Unicast

Collegamenti punto-punto half- e full-duplex
Collegamento Half-Duplex
    - Collegamento che permette solo a un partecipante di comunicare sul mezzo fisico in un istante di tempo
    - Quasi sempre inteso in modo ancora più stringente come comunicazione unidirezionale
Collegamento Full-Duplex
    - Possibilità per il mittente e il destinatario di comunicare in modo indipendente l'uno dall'altro (comunicazione bidirezionale)
    - Ad esempio, collegamento punto-punto con collegamenti interni dedicati per le due direzioni di trasferimento

ATTENZIONE: Attenzione a distinguere le modalità di trasmissione e le caratteristiche del mezzo 

Collegamenti del livello H2N
A livello H2N l'unità di dato trasmesso durante la comunicazione è chiamato FRAME (deriva da Framing, parte di livello fisico del livello H2N)

Adattatori per la comunicazione H2N
- Il protocollo H2N è solitamente implementato all'interno di una scheda adattatrice, conosciuta anche col nome di Network Interface Card o NIC
- Tutti i dispositivi (host, router, altri dispositivi di rete), per poter essere utilizzati in una rete LAN, devono essere dotati di una scheda di rete

Network Interface Card (NIC)
Dispositivo generalmente costituito da una RAM, un DSP (Digital Signal Processor), un'interfaccia bus/host e un'interfaccia di collegamento alla rete
    - Entità semi-autonoma rispetto al sistema in cui risiede, ha un microcontrollore dedicato  
    - Può essere sia integrata sulla scheda madre, oppure presente come dispositivo dedicato
    - (Ethernet) Connettore RJ45

Ethernet
Inventata a metà degli anni '70 da Metcalfe che propone Ethernet nella sua tesi di PhD
Il disegno originale prevedeva un solo canale di tipo BUS (canale condiviso broadcast, comunicazione logica di tipi Unicast) per connettere i nodi

LAN Ethernet    
Ethernet è stato pensato in origine per:
    - topologia a bus
    - velocità 1-10Mbps
Attualmente utilizzato:
    - quasi sempre in topologia a stella tramite l'impiego di ulteriori dispositivi di rete (bridge e switch)
    - supporta velocità differenti (anche decine di Gb/s) a seconda dell'HW impiegato

Caratteristiche Ethernet
Tipo di collegamento
    - Usa un Canale Fisico di tipo broadcast (non punto-punto): molti host connessi ad uno stesso canale di comunicazione
    - Quando un host trasmette un pacchetto sulla LAN, TUTTE le interfacce degli host collegati lo ricevono
Modalità di trasmissione
    - Permette comunicazioni Unicast fra host
    - Alcuni messaggi "speciali", necessari per il corretto funzionamento del protocollo, sono di tipo Broadcast

Ethernet
    a. Indirizzi Ethernet: MAC
    b. Frame Ethernet
    c. Protocollo ARP
    d. Accesso al mezzo trasmissivo (Protocollo CSMA/CD)

Indirizzi Ethernet: MAC
- A livello Ethernet, gli host utilizzano un indirizzo hardware o indirizzo MAC (Media Access Control)
- In realtà, l'indirizzo MAC non si riferisce all'host, ma al NIC (Network Interface Card) dell'host. 
  Ogni NIC ha un indirizzo LAN univoco di 48 bit (6 byte), tipicamente rappresentato da 6 coppie di numeri esadecimali. Es. 81:F4:A3:AA:9C:49
- L'indirizzo broadcast è FF-FF-FF-FF-FF-FF (tutti i bit a 1) --> il destinatario accetterà a prescindere il Frame Ethernet inviatogli da questo indirizzo
- L'indirizzo MAC di un NIC è univoco e permanente:
    - è chiamato anche hardware address perché incorporato nella ROM al momento della fabbricazione
    - univoco in quanto assegnato ai produttori di NIC (Network Interface Card) dell'autorità centrale IEEE
        - tipicamente i primi 3 byte definiscono chi ha prodotto quell'interfaccia di rete (Intel, Apple, Huawei, ...)
        - gli amministratori di rete possono modificare l'indirizzo MAC dell'interfaccia di rete di un host

Frame Ethernet
I pacchetti scambiati a livello H2N vengono detti frame
Indipendentemente dalla topologia, dai mezzi trasmissivi e dalla velocità di trasmissione, tutte le tecnologie Ethernet 
fanno uso dello stesso formato per il frame che trasmettono (Frame Ethernet)

Preambolo (8 byte): identifica la funzionalità di framing 
    - i primi 7 byte hanno valore 10101010
    - l'ultimo byte ha valore 10101011
    - i primi 7 byte servono per “attivare” gli adattatori dei riceventi e sincronizzare i loro orologi con quello del mittente
    - i due 1 consecutivi nell'ultimo byte avvisano l'adattatore del ricevente che la fase di sincronizzazione è terminata
Indirizzo destinazione (6 byte): MAC address dell'host di destinazione (filtraggio da parte dell'interfaccia di rete)
Indirizzo sorgente (6 byte): MAC address dell'host sorgente
Tipo (2 byte): implementa una funzionalità di multiplexing (più flussi in un unico canale trasmissivo) per stabilire a quale protocollo del livello superiore inoltrare il payload
    - necessario poichè esistono più protocolli di un livello dello stack TCP/IP
Dati (46 - 1500 byte): payload
CRC (Controllo a Ridondanza Ciclica, 4 byte): permette all'interfaccia che riceve i dati di rilevare la presenza di un errore nei bit del frame ricevuto 
    - il destinatario (o meglio la sua interfaccia di rete) ricalcola il CRC sulla base dei dati ricevuti (dest. address, source address, tipo, payload) e verifica la corrispondenza con quello ricevuto

Modalità promiscua: modalità dell'interfaccia di rete che permette di non filtrare i pacchetti a seconda dell'indirizzo di destinazione 
    - in caso di non corrispondenza dell'indirizzo di destinazione il pacchetto viene comunque accettato e non scartato

Protocollo ARP (Address Resolution Protocol)
L'Address Resolution Protocol (ARP) si occupa di individuare l'indirizzo MAC di un host della stessa LAN di cui conosce l'indirizzo IP
Il protocollo ARP è incluso nella suite di protocolli TCP/IP

Funzionamento
Utilizza due tipi di messaggi ARP:
    - richiesta contenente l'indirizzo IP del destinatario (Will 128.213.1.5 please send me his Ethernet address?)
    - risposta contenente il corrispondente indirizzo MAC (I'm 128.213.1.5, and my Ethernet address is 87:A2:15:35:02:C3)
ARP utilizza il broadcast della richiesta

INPUT: indirizzo IP
ARP-reply: indirizzo MAC 

Laboratorio
Comandi utilizzati: 
ifconfig eth0 192.168.0.1/24 --> configura l'indirizzo ip dell'interfaccia specificata
ifconfig eth0 --> stato di configurazione dell'interfaccia specificata

ip link show eth0 --> alternativa al comando ifconfig (il sottocomando "link" specifica il livello dello stack di cui vogliamo ottenere le informazioni)
ip addr show eth0 --> stato di configurazione dell'interfaccia specificata a livello 3
ip -json link show eth0 --> stesso output in formato json
ip -json link show eth0 | jq --> stesso output in formato più leggibile
ip -br link show eth0 --> minimizza l'output 
man ip
man ip-link
ip -br link show dev eth0 --> comando equivalente a quelli sopra
ip -br addr show dev eth0 --> comando equivalente a quelli sopra

ping 182.168.0.2 --> invio di messaggi all'indirizzo di destinazione specificato
tcpdump -eni eth0 --> analizza le comunicazioni (copia del traffico sulle interfacce di rete)
    - e: informazioni aggiuntive sul protocollo ethernet
    - n: serve ad evitare che il software ci mostri informazioni già interpretate
    - i: permette di specificare l'interfaccia